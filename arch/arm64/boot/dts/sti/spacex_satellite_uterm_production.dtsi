/*
 * Copyright (C) 2018 STMicroelectronics (R&D) Limited.
 * Author: Nicolas Toromanoff <nicolas.toromanoff@st.com>
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License version 2 as
 * published by the Free Software Foundation.
 */

#include "spacex_satellite_uterm_cut2.dtsi"
#include <dt-bindings/gpio/gpio.h>

/ {
	model = "spacex_satellite_user_terminal";

	gpios {
		/*
		 * GPS.
		 */
		gps_boot      = <&pio10 4 1>; /* 0=UART, 1=SPI  */
		gps_reset     = <&pio11 7 1>; /* 0=reset, 1=run */

		/*
		 * WiFi.
		 */
		wifi_reset    = <&pio11 4 1>; /* 0=reset */

		/*
		 * Reset changes depending on board revision - it is set in
		 * the board-specific files.
		 */

		/*
		 * Antenna. (DBFs + FEMs)
		 */
		ant_power     = <&pio30 5 0>; /* 1=power 0.95/1.0/1.8V */

		/*
		 * Shiraz. (DBFs)
		 */
		dbf_reset     = <&pio21 4 1>; /* 1=reset shiraz */
		dbf_v1p0_ok   = <&pio31 2>;

		/*
		 * Cady.
		 */
		cady_power    = <&pio11 5 0>; /* 0=off, 1=on */
		cady_v2p2_up  = <&pio21 7 0>; /* 0=2.2V, 1=2.6V */
		cady_v1p8_up  = <&pio10 5 0>; /* 0=1.8V, 1=2.2V */

		/*
		 * Board ID.
		 * See Confluence "User Terminal Catson ID Bits"
		 */
		id_b0         = <&pio12 2>;
		id_b1         = <&pio12 3>;
		id_b2         = <&pio12 0>;
		id_b3         = <&pio12 1>;
		id_b4         = <&pio20 4>;

		/*
		 * Actuator Control.
		 */
		motor2_nsleep = <&pio20 7 0>; /* 0=sleep_mode */
		motor2_ph     = <&pio20 6 0>; /* 0=reverse, 1=fwd */
		motor2_nfault = <&pio20 3>;   /* 0=at_fault */

		motor1_nsleep = <&pio20 0 0>; /* 0=sleep_mode */
		motor1_ph     = <&pio20 5 0>; /* 0=reverse, 1=fwd */
		motor1_nfault = <&pio22 2>;   /* 0=at_fault */
	};

	pwms {
		/*
		 * Adaptive voltage scaling.
		 */
		avs0          = <&pwm0 0>;
		avs1          = <&pwm0 1>;

		/*
		 * Actuator control motors.
		 */
		motor2        = <&pwm0 3>;
		motor1        = <&pwm0 2>;
	};

	soc {
		/*
		 * Motor PWM control.
		 */
		pwm@8800000 {
			status = "okay";
			st,max-pwm-cnt = <0xFFFF>;
		};

		/*
		 * Configure SCP-lite GPIO pin.
		 */
		catson_scp0: scp0@c700000 {
			pinctrl-0 = <&pinctrl_scp_lite_default>;
			pinctrl-names = "default";
		};

		/*
		 * Configure l1s2sync to use only the outa pin.
		 */
		l1l2sync: l1l2sync {
			pinctrl-0 = <&pinctrl_l1sync_outa &pinctrl_gps_1pps>;
		};

		/*
		 * Configure serial to only use tx and rx lines.
		 */
		serial0: serial@8850000 {
			pinctrl-0 = <&pinctrl_serial0_txrx>;
		};

		serial1: serial@8860000 {
			pinctrl-0 = <&pinctrl_serial1_txrx>;
		};

		/*
		 * ePHY LEDs.
		 */
		ephy: ephy@16702100 {
			pinctrl-names = "default";
			pinctrl-0 = <&ephy_led_alt>;
		};

		/*
		 * IMU sensor.
		 */
		imu_spi: spi2@8830000 {
			status = "okay";

			#address-cells = <1>;
			#size-cells = <0>;
			num-cs = <1>;
			cs-gpios = <&pio21 3 GPIO_ACTIVE_LOW>;

			ism330dxc@0 {
				compatible = "st,ism330dhc";
				reg = <0>;

				interrupt-parent = <&pio12>;
				interrupts = <5 IRQ_TYPE_EDGE_RISING>;

				/* 26.3mhz chip Catson limited to 10.000MHz */
				spi-max-frequency = <10000000>;
			};
		};
	};
};
